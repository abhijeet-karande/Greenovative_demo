name: Run Postman Collection

# Trigger the workflow on every push to the main branch
on:
  push:
    branches:
      - main
jobs:
  automated-api-tests:
    runs-on: windows-latest
    steps:
      - uses: actions/checkout@v4
      - name: Install Postman CLI
        run: |
          powershell.exe -NoProfile -InputFormat None -ExecutionPolicy AllSigned -Command "[System.Net.ServicePointManager]::SecurityProtocol = 3072; iex ((New-Object System.Net.WebClient).DownloadString('https://dl-cli.pstmn.io/install/win64.ps1'))"
      - name: Login to Postman CLI
        run: postman login --with-api-key ${{ secrets.POSTMAN_API_KEY }}
      - name: Run API tests
        run: |
          postman collection run "29992740-254b5d5b-2ce0-497c-97d3-096b78dc56c2" -e "29992740-2eb4870a-77fc-4723-abaa-3cc47258ca14"

  newman-tests:
    runs-on: windows-latest  # Use the latest Windows runner

    steps:
      - name: Checkout code
        uses: actions/checkout@v2  # Checkout the repository code

      - name: Set up Node.js
        uses: actions/setup-node@v2  # Set up Node.js
        with:
          node-version: '16'  # Specify the Node.js version

      - name: Install Newman 
        run: |
          npm install -g newman
      - name: Install HTML Reporter   
        run: |  
          npm i -g newman-reporter-htmlextra  # Install the HTML reporter globally

      - name: Run Newman
        run: |
          newman run postman/User_collection.json -e postman/User_environment.json --reporters cli,html --reporter-html-export postman/reports/newman-report.html  # Run the Postman collection with Newman and generate an HTML report
